<!DOCTYPE html>
<html lang="pt-br">

<head>
	<meta charset="UTF-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<title>Sistema Vendas</title>
</head>

<body>
	<script src="metodos.js" type="text/javascript"></script>

	<h1 id="lblh1">Clientes</h1>

	<div class="form-floating mb-3">
		<input type="text" class="form-control" id="floatingInput" placeholder="Id">
		<label for="floatingInput">Id</label>
	</div>

	<div class="form-floating">
		<input disabled="true" type="text" class="form-control" id="floatingNome" placeholder="Nome">
		<label for="floatingNome">Nome</label>
	</div>

	<br>

	<div class="form-floating">
		<input style="display:none" type="text" class="form-control" id="floatingImage">
		<label style="display:none" for="floatingImage" id="lblImage">Link da imagem</label>
	</div>

	<div class="form-floating">
		<a style="display:none" id="visualizarFoto"
			class="link-offset-2 link-underline link-underline-opacity-0">VISUALIZAR FOTO PERFIL</a>
	</div>

	<br>

	<button class="btn btn-success" id="btnBuscar" onclick="buscarCliente()" type="button">BUSCAR</button>

	<button class="btn btn-warning" id="btnTelaCadastrar" onclick="exibirTelaCadastrarCliente()"
		type="button">CADASTRAR</button>

	<button onclick="atualizarImagem()" class="btn btn-warning" id="btnEnviarAlteracaoImagem"
		style="display:none">ENVIAR</button>

	<button onclick="cadastrarCliente()" id="btnEnviarCadastro" type="submit" class="btn btn-warning"
		style="display:none">ENVIAR</button>

	<button onclick="alterarCliente()" id="btnEnviarAlteracao" type="submit" class="btn btn-warning"
		style="display:none">ENVIAR</button>

	<button onclick="exibirTelaAlterarCliente()" id="btnTelaAlterarCadastro" class="btn btn-info"
		style="display:none">ALTERAR</button>

	<button onclick="deletarCliente()" id="btnTelaDeletar" class="btn btn-danger" style="display:none">DELETAR</button>

	<button onclick="alterarImagem()" id="btnAlterarImagem" class="btn btn-info" style="display:none">ALTERAR
		IMAGEM</button>
	<br>
	<br>

</body>
<script>
	
function exibicaoPadraoBusca() {
	desabilitarTodosOsBotoes();

	document.getElementById("btnBuscar").style.display = "inline";

	document.getElementById("btnTelaCadastrar").style.display = "inline";

	document.getElementById("floatingInput").disabled = false;

	document.getElementById("floatingNome").disabled = true;

	document.getElementById("floatingImage").style.display = "none";

	document.getElementById("lblImage").style.display = "none";

	document.getElementById("lblh1").textContent = "Clientes";

	document.getElementById("visualizarFoto").style.display = "none";
}

	function limparCampos() {
		document.getElementById("floatingInput").value = "";

		document.getElementById("floatingNome").value = "";
	}


	function buscarCliente() {
		exibicaoPadraoBusca();

		fetch('api/clientes/' + document.getElementById("floatingInput").value)
			.then((response) => {
				if (response.status != 200) {
					document.getElementById("floatingNome").value = "";
					alert("Cliente nao localizado")
				} else {
					document.getElementById("btnTelaAlterarCadastro").style.display = "inline";
					document.getElementById("btnTelaDeletar").style.display = "inline";
					document.getElementById("btnAlterarImagem").style.display = "inline";
					return response.json();
				}
			})
			.then((data) => {
				document.getElementById("floatingNome").value = data.nome;
				if (data.imagem != null) {
					document.getElementById("visualizarFoto").style.display = "inline";
					document.getElementById("visualizarFoto").href = data.imagem;
					document.getElementById("visualizarFoto").target = "_blank";
				}
			}
			);

	}


	function exibirTelaCadastrarCliente() {
		desabilitarTodosOsBotoes();

		limparCampos();

		document.getElementById("floatingInput").disabled = true;

		document.getElementById("floatingInput").value = "";

		document.getElementById("floatingNome").disabled = false;

		document.getElementById("lblh1").textContent = "Cadastrar Cliente";

		document.getElementById("btnEnviarCadastro").style.display = "inline";

		document.getElementById("visualizarFoto").style.display = "none";
	}

	function cadastrarCliente() {

		const url = "api/clientes";
		const requestOptions = {
			method: "POST",
			body:
				document.getElementById("floatingNome").value
		};
		console.log();
		fetch(url, requestOptions)
			.then((response) => {
				return response.json();
			}
			)
			.then((data) => {
				alert("Cliente cadastrado com sucesso")
				document.getElementById("floatingInput").value = data.id
				desabilitarTodosOsBotoes();
				buscarCliente();
			});

		;
	}

	function exibirTelaAlterarCliente() {
		desabilitarTodosOsBotoes();

		document.getElementById("floatingInput").disabled = true;

		document.getElementById("floatingNome").disabled = false;

		document.getElementById("lblh1").textContent = "Alterar Cliente";

		document.getElementById("btnEnviarAlteracao").style.display = "inline";

		document.getElementById("visualizarFoto").style.display = "none";
	}

	function alterarCliente() {
		const url = "api/clientes/" + document.getElementById("floatingInput").value;
		const requestOptions = {
			method: "PUT",
			body:
				document.getElementById("floatingNome").value
		};

		fetch(url, requestOptions)
			.then((response) => {
				return response.json();
			}
			)
			.then((data) => {
				alert("Cliente alterado com sucesso");
				document.getElementById("floatingInput").value = data.id;
				desabilitarTodosOsBotoes();
				buscarCliente();
			});
	}

	function deletarCliente() {

		if (confirm("Tem certeza de que deseja excluir este cliente ?")) {
			const url = "api/clientes/" + document.getElementById("floatingInput").value;
			const requestOptions = {
				method: "DELETE"
			};

			fetch(url, requestOptions)

			alert("Cliente excluido com sucesso");

			exibicaoPadraoBusca();

			limparCampos();
		}

	}

	function alterarImagem() {
		desabilitarTodosOsBotoes();

		document.getElementById("visualizarFoto").style.display = "none";

		document.getElementById("floatingInput").disabled = true;

		document.getElementById("floatingNome").disabled = true;

		document.getElementById("btnEnviarAlteracaoImagem").style.display = "inline";

		document.getElementById("lblh1").textContent = "Alterar Imagem Cliente";
		
		document.getElementById("floatingImage").style.display = "inline";

		document.getElementById("lblImage").style.display = "inline";

	}

	function atualizarImagem() {
		const url = "api/clientes/imagem/" + document.getElementById("floatingInput").value;
		const requestOptions = {
			method: "PUT",
			body:
				document.getElementById("floatingImage").value
		};

		fetch(url, requestOptions)
			.then((response) => {
				return response.json();
			}
			)
			.then((data) => {
				alert("Imagem alterada com sucesso");
				document.getElementById("floatingInput").value = data.id;
				desabilitarTodosOsBotoes();
				buscarCliente();
			});
	}

</script>

</html>